

CREATE TABLE USERS(\
AADHAAR_ID		NUMBER(12)		PRIMARY KEY,\
NAME				VARCHAR2(100)	NOT NULL,\
AGE				NUMBER(3),\
DOOR#			NUMBER,\
STREET			VARCHAR2(100),\
CITY				VARCHAR2(100),\
STATE				VARCHAR2(100),\
PINCODE			NUMBER,\
O_FLAG			NUMBER(1),\
T_FLAG			NUMBER(1),\
M_FLAG			NUMBER(1),\
SU_FLAG			NUMBER(1));\
\
\
CREATE TABLE USER_PHONE(\
AID					NUMBER(12),\
PHONE#			NUMBER(10),\
PRIMARY KEY(AID, PHONE#));\
\
ALTER TABLE USER_PHONE ADD CONSTRAINT FK1 FOREIGN KEY(AID) REFERENCES USERS(AADHAAR_ID);\
\
\
CREATE TABLE LOGIN(\
AID					NUMBER(12),\
USER_NAME		VARCHAR2(100),\
PASSWORD		VARCHAR2(50)		NOT NULL);\
\
ALTER TABLE LOGIN ADD CONSTRAINT FK2 FOREIGN KEY(AID) REFERENCES USERS(AADHAAR_ID);\
\
\
CREATE TABLE PROPERTY(\
PROPERTY_ID		NUMBER(10)			PRIMARY KEY,\
TOTAL_FLOORS	NUMBER(3),\
TOTAL_AREA		NUMBER				NOT NULL,\
PLINTH_AREA		NUMBER				NOT NULL,\
CONST_YEAR		NUMBER(4)			NOT NULL,\
DOOR#			NUMBER,\
STREET			VARCHAR2(100),\
CITY				VARCHAR2(100),\
STATE				VARCHAR2(100),\
PINCODE			NUMBER,\
PERCENT_HIKE	NUMBER(5),\
RENT				NUMBER,\
R_FLAG			NUMBER(1),\
TOTAL_BED		NUMBER,\
C_FLAG			NUMBER(1));\
\
\
CREATE TABLE PROP_OWNED(\
AID					NUMBER(12),\
PID					NUMBER(10),\
AVAIL_FROM		DATE,\
AVAIL_TILL			DATE,\
PRIMARY KEY(AID, PID));\
\
ALTER TABLE PROP_OWNED ADD CONSTRAINT FK3 FOREIGN KEY(AID) REFERENCES USERS(AADHAAR_ID);\
ALTER TABLE PROP_OWNED ADD CONSTRAINT FK4 FOREIGN KEY(PID) REFERENCES PROPERTY(PROPERTY_ID);\
\
\
CREATE TABLE PROP_RENTED(\
AID					NUMBER(12),\
PID					NUMBER(10),\
START_DATE		DATE,\
END_DATE			DATE,\
PERCENT_COMM	NUMBER,\
PRIMARY KEY(AID, PID));\
\
ALTER TABLE PROP_RENTED ADD CONSTRAINT FK5 FOREIGN KEY(AID) REFERENCES USERS(AADHAAR_ID);\
ALTER TABLE PROP_RENTED ADD CONSTRAINT FK6 FOREIGN KEY(PID) REFERENCES PROPERTY(PROPERTY_ID);\
\
\
\
CREATE OR REPLACE PROCEDURE InsertPropertyRecord(AID IN NUMBER, PID IN NUMBER, FLOORS IN NUMBER, TA IN NUMBER, PA IN NUMBER, YR IN NUMBER, DOOR IN NUMBER, STREET IN NUMBER, CITY IN NUMBER, STATE IN NUMBER, PINCODE IN NUMBER, HIKE IN NUMBER, RENT IN NUMBER, R IN NUMBER, BED IN NUMBER, C IN NUMBER, FD IN DATE, TD NI DATE) AS\
CURRENT VARCHAR2;\
ID NUMBER;\
M NUMBER\
BEGIN\
CURRENT := USER;\
SELECT AID INTO ID FROM LOGIN WHERE USER_NAME = CURRENT;\
SELECT M_FLAG INTO M FROM USERS WHERE AADHAAR_ID = AID;\
IF (ID = AID) THEN\
	UPDATE USERS SET O_FLAG = 1 WHERE AADHAAR_ID = AID;\
	INSERT INTO PROPERTY VALUES(PID, FLOORS, TA, PA, YR, DOOR, STREET, CITY, STATE, PINCODE, HIKE, RENT, R, BED, C);\
	INSERT INTO PROP_OWNED VALUES(AID, PID, FD, TD);\
ELSEIF (M = 1) THEN\
	UPDATE USERS SET O_FLAG = 1 WHERE AADHAAR_ID = AID;\
	INSERT INTO PROPERTY VALUES(PID, FLOORS, TA, PA, YR, DOOR, STREET, CITY, STATE, PINCODE, HIKE, RENT, R, BED, C);\
	INSERT INTO PROP_OWNED VALUES(AID, PID, FD, TD);\
ELSE\
	DBMS_OUTPUT.PUT_LINE(\'91INSERT NOT POSSIBLE.\'92);\
END IF;\
END;\
/\
\
\
CREATE OR REPLACE PROCEDURE GetPropertyRecord(OWNER_ID IN NUMBER) AS\
BEGIN\
SELECT * FROM PROPERTY WHERE PROPERTY_ID IN (SELECT PID FROM PROP_OWNED WHERE AID = OWNER_ID);\
DBMS_OUTPUT.PUT_LINE(\'91INSERT DONE.\'92);\
END;\
/\
\
\
CREATE OR REPLACE PROCEDURE GetTenantDetails(PROP_ID IN NUMBER) AS\
BEGIN\
DBMS_OUTPUT.PUT_LINE(\'91PROPERTY CURRENTLY IDLE\'92);\
DBMS_OUTPUT.PUT_LINE(\'91TENANT DETAILS ARE :\'92);\
SELECT AADHAAR_ID, NAME, AGE, DOOR#, STREET, CITY, STATE, PINCODE FROM USERS WHERE AADHAAR_ID IN (SELECT AID FROM PROP_RENTED WHERE PID = PROP_ID);\
END;\
/\
\
\
CREATE OR REPLACE PROCEDURE CreateNewUser(AID IN NUMBER, NAME IN VARCHAR2, AGE IN NUMBER, DOOR IN NUMBER, STREET IN VARCHAR2, CITY IN VARCHAR2, STATE IN VARCHAR2, PINCODE IN NUMBER, O_FLAG IN NUMBER, T_FLAG IN NUMBER, M_FLAG IN NUMBER, SU_FLAG IN NUMBER, PHONE IN NUMBER, U_NAME IN VARCHAR, PASS IN VARCHAR) AS\
CURRENT VARCHAR2;\
SU NUMBER;\
BEGIN\
CURRENT := USER;\
SELECT S_FLAG INTO SU FROM USERS, LOGIN WHERE AADHAAR_ID = AID AND USER_NAME = CURRENT;\
IF (SU = 0) THEN\
	DBMS_OUTPUT.PUT_LINE(\'91CURRENT USER CANNOT CREATE A NEW USER.\'92);\
ELSEIF (U_NAME IN (SELECT USER_NAME FROM LOGIN) THEN\
	DBMS_OUTPUT.PUT_LINE(\'91USER_NAME ALREADY TAKEN.\'92);\
ELSE\
	CREATE USER U_NAME IDENTIFIED BY PASS;\
	INSERT INTO USERS VALUES(AID, NAME, AGE, DOOR, STREET, CITY, STATE, PINCODE, O_FLAG, T_FLAG, M_FLAG, SU_FLAG);\
	INSERT INTO USER_PHONE VALUES(AID, PHONE);\
	INSERT INTO LOGIN(AID, U_NAME, PASS);\
END;\
/\
\
\
CREATE OR REPLACE PROCEDURE SearchPropertyForRent(C IN VARCHAR2) AS\
CURR_DATE DATE;\
BEGIN\
SELECT CURRENT_DATE INTO CURR_DATE FROM DUAL;\
DBMS_OUTPUT.PUT_LINE(\'91PROPERTY IN \'92||CITY||\'92 CITY IS :\'92);\
((SELECT * FROM PROPERTY WHERE CITY = C) MINUS (SELECT * FROM PROPERTY WHERE (CURR_DATE BETWEEN START_DATE AND END_DATE) AND PROPERTY_ID IN (SELECT PID FROM PROP_RENTED));\
END;\
/\
\
\
CREATE OR REPLACE PROCEDURE GetRentHistory(PROP_ID IN NUMBER) AS\
BEGIN\
SELECT * FROM PROP_RENTED WHERE PID = PROP_ID;\
END;\
/}